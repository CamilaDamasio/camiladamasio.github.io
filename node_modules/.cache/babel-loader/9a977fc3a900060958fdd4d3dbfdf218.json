{"ast":null,"code":"var _jsxFileName = \"/home/camila/Projetos/sd-012-project-recipes-app/src/pages/FoodInProgress.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useParams, Redirect } from 'react-router-dom';\nimport { Button, Form } from 'react-bootstrap';\nimport ShareBtn from '../components/ShareBtn';\nimport whiteHeartIcon from \"../images/whiteHeartIcon.svg\";\nimport blackHeartIcon from \"../images/blackHeartIcon.svg\";\nimport { foodById } from '../utils/fetchAPIbyID';\nimport useRedirect from '../hooks/useRedirect';\n\nfunction FoodInProgress() {\n  const {\n    id\n  } = useParams();\n  const [foodDetails, setFoodDetails] = useState({});\n  const {\n    shouldRedirect,\n    redirect\n  } = useRedirect();\n  const [progress, setProgress] = useState([]);\n  const [disabled, setDisabled] = useState(true);\n  useEffect(() => {\n    const fetchMeals = async () => {\n      const food = await foodById(id);\n      setFoodDetails(food);\n      const inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n\n      if (inProgressRecipes && progress.length === 0 && Object.keys(inProgressRecipes.meals).some(key => key === id)) {\n        const {\n          meals\n        } = inProgressRecipes;\n        const loadedProgress = meals[id];\n        setProgress(loadedProgress);\n        const inputs = document.querySelectorAll('input');\n\n        if (inputs) {\n          inputs.forEach(input => {\n            if (loadedProgress.some(value => value === input.parentElement.querySelector('label').innerText)) {\n              input.defaultChecked = true;\n              input.parentElement.querySelector('label').style.textDecoration = 'line-through';\n            }\n          });\n        }\n      }\n    };\n\n    const favoriteRecipes = JSON.parse(localStorage.getItem('favoriteRecipes'));\n\n    if (favoriteRecipes) {\n      const isFavorite = () => favoriteRecipes.some(recipe => recipe.id === id) && document.getElementById('fav-btn').setAttribute('src', blackHeartIcon);\n\n      isFavorite();\n    }\n\n    fetchMeals();\n  }, [id, progress]);\n  const retObj = Object.entries(foodDetails);\n  const listIngredients = retObj.filter(meal => meal[0].includes('Ingredient') && meal[1]);\n  const filterAlcoohol = retObj.filter(meal => {\n    const noAlcool = meal[1] !== ' ' && meal[1] !== null;\n    return meal[0].includes('Measure') && noAlcool;\n  });\n\n  const progressRecipe = labelValue => {\n    let updatedProgress = [];\n\n    if (!progress.some(value => value === labelValue)) {\n      updatedProgress = progress.concat(labelValue);\n      setProgress(updatedProgress);\n    } else {\n      updatedProgress = progress.filter(ingredient => ingredient !== labelValue);\n      setProgress(updatedProgress);\n    }\n\n    let inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n\n    if (!inProgressRecipes) {\n      inProgressRecipes = {\n        meals: {\n          [id]: updatedProgress\n        }\n      };\n    } else {\n      let {\n        meals\n      } = inProgressRecipes;\n\n      if (inProgressRecipes.meals) {\n        meals[id] = updatedProgress;\n      } else {\n        const recipeProgress = {\n          [id]: [...updatedProgress]\n        };\n        meals = { ...meals,\n          ...recipeProgress\n        };\n      }\n\n      inProgressRecipes.meals = meals;\n    }\n\n    localStorage.setItem('inProgressRecipes', JSON.stringify(inProgressRecipes));\n  };\n\n  const isDisabled = () => {\n    const el = document.querySelectorAll('input');\n\n    if (!Array.from(el).every(x => x.checked)) {\n      setDisabled(true);\n    } else {\n      setDisabled(false);\n    }\n  };\n\n  const finishRecipe = () => {\n    const {\n      strArea,\n      strCategory,\n      strMealThumb,\n      strMeal,\n      strTags\n    } = foodDetails;\n    const d = new Date();\n    const dataDMY = `${d.getDay()}/${d.getMonth()}/${d.getFullYear()}`;\n    const dataTIME = `${d.getHours()}hrs${d.getMinutes()}min`;\n    let arrTag;\n\n    if (strTags) {\n      arrTag = strTags.split(',');\n    } else {\n      arrTag = '';\n    }\n\n    const finishedRecipeToken = {\n      id,\n      type: 'comida',\n      area: strArea,\n      category: strCategory,\n      alcoholicOrNot: '',\n      name: strMeal,\n      image: strMealThumb,\n      doneDate: `${dataDMY} às ${dataTIME}`,\n      tags: arrTag\n    };\n    const inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n\n    if ((Object.keys(inProgressRecipes).length && Object.keys(inProgressRecipes.meals).length) === 1) {\n      localStorage.removeItem('inProgressRecipes');\n    } else {\n      delete inProgressRecipes.meals[id];\n    }\n\n    let doneRecipes = JSON.parse(localStorage.getItem('doneRecipes'));\n\n    if (doneRecipes) {\n      doneRecipes.push(finishedRecipeToken);\n    } else {\n      doneRecipes = [finishedRecipeToken];\n    }\n\n    localStorage.setItem('doneRecipes', JSON.stringify(doneRecipes));\n    shouldRedirect('/receitas-feitas');\n  };\n\n  const setFavorite = () => {\n    const {\n      strArea,\n      strCategory,\n      strMealThumb,\n      strMeal\n    } = foodDetails;\n    const favoriteRecipeToken = {\n      id,\n      type: 'comida',\n      area: strArea,\n      category: strCategory,\n      alcoholicOrNot: '',\n      name: strMeal,\n      image: strMealThumb\n    };\n    let favoriteRecipes = JSON.parse(localStorage.getItem('favoriteRecipes'));\n\n    if (favoriteRecipes) {\n      if (favoriteRecipes.some(recipe => recipe.id !== favoriteRecipeToken.id)) {\n        favoriteRecipes.push(favoriteRecipeToken);\n        document.getElementById('fav-btn').setAttribute('src', blackHeartIcon);\n      } else {\n        favoriteRecipes = favoriteRecipes.filter(recipe => recipe.id !== favoriteRecipeToken.id);\n        document.getElementById('fav-btn').setAttribute('src', whiteHeartIcon);\n      }\n    } else {\n      favoriteRecipes = [favoriteRecipeToken];\n      document.getElementById('fav-btn').src = blackHeartIcon;\n    }\n\n    localStorage.setItem('favoriteRecipes', JSON.stringify(favoriteRecipes));\n\n    if (Object.values(favoriteRecipes).length === 0) {\n      localStorage.removeItem('favoriteRecipes');\n    }\n  };\n\n  console.log(foodDetails);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    onChange: isDisabled,\n    className: \"in-progress\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 5\n    }\n  }, redirect.should && /*#__PURE__*/React.createElement(Redirect, {\n    to: redirect.path,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 28\n    }\n  }), /*#__PURE__*/React.createElement(\"img\", {\n    src: foodDetails.strMealThumb,\n    alt: \"imagem da comida\",\n    \"data-testid\": \"recipe-photo\",\n    className: \"in-progress-pic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"h1\", {\n    \"data-testid\": \"recipe-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }\n  }, foodDetails.strMeal), /*#__PURE__*/React.createElement(ShareBtn, {\n    id: id,\n    type: \"comida\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    variant: \"danger\",\n    type: \"button\",\n    onClick: setFavorite,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    id: \"fav-btn\",\n    src: whiteHeartIcon,\n    alt: \"favoritar\",\n    \"data-testid\": \"favorite-btn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"h2\", {\n    \"data-testid\": \"recipe-category\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }\n  }, foodDetails.strCategory), /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 7\n    }\n  }, \"Ingredientes:\"), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 7\n    }\n  }, listIngredients.map((ingredient, index) => /*#__PURE__*/React.createElement(\"li\", {\n    key: index,\n    \"data-testid\": `${index}-ingredient-step`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Form.Group, {\n    className: \"mb-3\",\n    controlId: `${index}-ingredient-step`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Form.Check, {\n    type: \"checkbox\",\n    id: `${index}-ingredient-step`,\n    label: filterAlcoohol[index] ? `${ingredient[1]} - ${filterAlcoohol[index][1]}` : ingredient[1],\n    onChange: ({\n      target\n    }) => {\n      const label = target.parentElement.querySelector('label');\n      progressRecipe(label.innerText);\n\n      if (target.checked) {\n        label.style.textDecoration = 'line-through';\n      } else if (!target.checked) {\n        target.defaultChecked = false;\n        label.style.textDecoration = 'none';\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 15\n    }\n  }))))), /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }\n  }, \"Instructions: \"), /*#__PURE__*/React.createElement(\"h2\", {\n    \"data-testid\": \"instructions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    }\n  }, foodDetails.strInstructions), /*#__PURE__*/React.createElement(Button, {\n    disabled: disabled,\n    type: \"button\",\n    \"data-testid\": \"finish-recipe-btn\",\n    className: \"finishRecipe\",\n    onClick: finishRecipe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }\n  }, \"Finalizar Receita\"));\n}\n\nexport default FoodInProgress;","map":{"version":3,"sources":["/home/camila/Projetos/sd-012-project-recipes-app/src/pages/FoodInProgress.jsx"],"names":["React","useState","useEffect","useParams","Redirect","Button","Form","ShareBtn","foodById","useRedirect","FoodInProgress","id","foodDetails","setFoodDetails","shouldRedirect","redirect","progress","setProgress","disabled","setDisabled","fetchMeals","food","inProgressRecipes","JSON","parse","localStorage","getItem","length","Object","keys","meals","some","key","loadedProgress","inputs","document","querySelectorAll","forEach","input","value","parentElement","querySelector","innerText","defaultChecked","style","textDecoration","favoriteRecipes","isFavorite","recipe","getElementById","setAttribute","blackHeartIcon","retObj","entries","listIngredients","filter","meal","includes","filterAlcoohol","noAlcool","progressRecipe","labelValue","updatedProgress","concat","ingredient","recipeProgress","setItem","stringify","isDisabled","el","Array","from","every","x","checked","finishRecipe","strArea","strCategory","strMealThumb","strMeal","strTags","d","Date","dataDMY","getDay","getMonth","getFullYear","dataTIME","getHours","getMinutes","arrTag","split","finishedRecipeToken","type","area","category","alcoholicOrNot","name","image","doneDate","tags","removeItem","doneRecipes","push","setFavorite","favoriteRecipeToken","whiteHeartIcon","src","values","console","log","should","path","map","index","target","label","strInstructions"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, Redirect } from 'react-router-dom';\nimport { Button, Form } from 'react-bootstrap';\nimport ShareBtn from '../components/ShareBtn';\nimport whiteHeartIcon from '../images/whiteHeartIcon.svg';\nimport blackHeartIcon from '../images/blackHeartIcon.svg';\nimport { foodById } from '../utils/fetchAPIbyID';\nimport useRedirect from '../hooks/useRedirect';\n\nfunction FoodInProgress() {\n  const { id } = useParams();\n  const [foodDetails, setFoodDetails] = useState({});\n  const { shouldRedirect, redirect } = useRedirect();\n  const [progress, setProgress] = useState([]);\n  const [disabled, setDisabled] = useState(true);\n  useEffect(() => {\n    const fetchMeals = async () => {\n      const food = await foodById(id);\n      setFoodDetails(food);\n      const inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n      if (inProgressRecipes && progress\n        .length === 0 && Object.keys(inProgressRecipes.meals)\n        .some((key) => key === id)) {\n        const { meals } = inProgressRecipes;\n        const loadedProgress = meals[id];\n        setProgress(loadedProgress);\n        const inputs = document.querySelectorAll('input');\n        if (inputs) {\n          inputs.forEach((input) => {\n            if (loadedProgress.some((value) => value === input.parentElement\n              .querySelector('label').innerText)) {\n              input.defaultChecked = true;\n              input.parentElement\n                .querySelector('label').style.textDecoration = 'line-through';\n            }\n          });\n        }\n      }\n    };\n    const favoriteRecipes = JSON.parse(localStorage.getItem('favoriteRecipes'));\n    if (favoriteRecipes) {\n      const isFavorite = () => favoriteRecipes\n        .some((recipe) => recipe.id === id) && document.getElementById('fav-btn')\n        .setAttribute('src', blackHeartIcon);\n      isFavorite();\n    }\n    fetchMeals();\n  }, [id, progress]);\n\n  const retObj = Object.entries(foodDetails);\n  const listIngredients = retObj.filter((meal) => (\n    meal[0].includes('Ingredient') && meal[1]\n  ));\n  const filterAlcoohol = retObj.filter((meal) => {\n    const noAlcool = meal[1] !== ' ' && meal[1] !== null;\n    return meal[0].includes('Measure') && noAlcool;\n  });\n\n  const progressRecipe = (labelValue) => {\n    let updatedProgress = [];\n    if (!progress.some((value) => value === labelValue)) {\n      updatedProgress = progress.concat(labelValue);\n      setProgress(updatedProgress);\n    } else {\n      updatedProgress = progress.filter((ingredient) => ingredient !== labelValue);\n      setProgress(updatedProgress);\n    }\n    let inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n    if (!inProgressRecipes) {\n      inProgressRecipes = {\n        meals: { [id]: updatedProgress },\n      };\n    } else {\n      let { meals } = inProgressRecipes;\n      if (inProgressRecipes.meals) {\n        meals[id] = updatedProgress;\n      } else {\n        const recipeProgress = { [id]: [...updatedProgress] };\n        meals = { ...meals, ...recipeProgress };\n      }\n      inProgressRecipes.meals = meals;\n    }\n    localStorage.setItem('inProgressRecipes', JSON.stringify(inProgressRecipes));\n  };\n\n  const isDisabled = () => {\n    const el = document.querySelectorAll('input');\n    if (!(Array.from(el).every((x) => x.checked))) {\n      setDisabled(true);\n    } else {\n      setDisabled(false);\n    }\n  };\n\n  const finishRecipe = () => {\n    const { strArea, strCategory, strMealThumb, strMeal, strTags } = foodDetails;\n    const d = new Date();\n    const dataDMY = `${d.getDay()}/${d.getMonth()}/${d.getFullYear()}`;\n    const dataTIME = `${d.getHours()}hrs${d.getMinutes()}min`;\n    let arrTag;\n    if (strTags) {\n      arrTag = strTags.split(',');\n    } else {\n      arrTag = '';\n    }\n    const finishedRecipeToken = {\n      id,\n      type: 'comida',\n      area: strArea,\n      category: strCategory,\n      alcoholicOrNot: '',\n      name: strMeal,\n      image: strMealThumb,\n      doneDate: `${dataDMY} às ${dataTIME}`,\n      tags: arrTag,\n    };\n    const inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n    if ((Object.keys(inProgressRecipes)\n      .length && Object.keys(inProgressRecipes.meals).length) === 1) {\n      localStorage.removeItem('inProgressRecipes');\n    } else {\n      delete inProgressRecipes.meals[id];\n    }\n    let doneRecipes = JSON.parse(localStorage.getItem('doneRecipes'));\n    if (doneRecipes) {\n      doneRecipes.push(finishedRecipeToken);\n    } else {\n      doneRecipes = [finishedRecipeToken];\n    }\n    localStorage.setItem('doneRecipes', JSON.stringify(doneRecipes));\n    shouldRedirect('/receitas-feitas');\n  };\n\n  const setFavorite = () => {\n    const { strArea, strCategory, strMealThumb, strMeal } = foodDetails;\n\n    const favoriteRecipeToken = {\n      id,\n      type: 'comida',\n      area: strArea,\n      category: strCategory,\n      alcoholicOrNot: '',\n      name: strMeal,\n      image: strMealThumb,\n    };\n\n    let favoriteRecipes = JSON.parse(localStorage.getItem('favoriteRecipes'));\n    if (favoriteRecipes) {\n      if (favoriteRecipes.some((recipe) => recipe.id !== favoriteRecipeToken.id)) {\n        favoriteRecipes.push(favoriteRecipeToken);\n        document.getElementById('fav-btn').setAttribute('src', blackHeartIcon);\n      } else {\n        favoriteRecipes = favoriteRecipes\n          .filter((recipe) => recipe.id !== favoriteRecipeToken.id);\n        document.getElementById('fav-btn').setAttribute('src', whiteHeartIcon);\n      }\n    } else {\n      favoriteRecipes = [favoriteRecipeToken];\n      document.getElementById('fav-btn').src = blackHeartIcon;\n    }\n    localStorage.setItem('favoriteRecipes', JSON.stringify(favoriteRecipes));\n    if (Object.values(favoriteRecipes).length === 0) {\n      localStorage.removeItem('favoriteRecipes');\n    }\n  };\n  console.log(foodDetails);\n\n  return (\n    <div onChange={ isDisabled } className=\"in-progress\">\n      { redirect.should && <Redirect to={ redirect.path } />}\n      <img\n        src={ foodDetails.strMealThumb }\n        alt=\"imagem da comida\"\n        data-testid=\"recipe-photo\"\n        className=\"in-progress-pic\"\n      />\n      <h1 data-testid=\"recipe-title\">{ foodDetails.strMeal }</h1>\n\n      <ShareBtn id={ id } type=\"comida\" />\n      <Button variant=\"danger\" type=\"button\" onClick={ setFavorite }>\n        <img\n          id=\"fav-btn\"\n          src={ whiteHeartIcon }\n          alt=\"favoritar\"\n          data-testid=\"favorite-btn\"\n        />\n      </Button>\n      <h2 data-testid=\"recipe-category\">{ foodDetails.strCategory }</h2>\n      <h3>Ingredientes:</h3>\n      <ul>\n        {listIngredients.map((ingredient, index) => (\n          <li\n            key={ index }\n            data-testid={ `${index}-ingredient-step` }\n          >\n            <Form.Group className=\"mb-3\" controlId={ `${index}-ingredient-step` }>\n              <Form.Check\n                type=\"checkbox\"\n                id={ `${index}-ingredient-step` }\n                label={ filterAlcoohol[index] ? (\n                  `${ingredient[1]} - ${filterAlcoohol[index][1]}`\n                ) : (ingredient[1]) }\n                onChange={ ({ target }) => {\n                  const label = target.parentElement.querySelector('label');\n                  progressRecipe(label.innerText);\n                  if (target.checked) {\n                    label.style.textDecoration = 'line-through';\n                  } else if (!target.checked) {\n                    target.defaultChecked = false;\n                    label.style.textDecoration = 'none';\n                  }\n                } }\n              />\n            </Form.Group>\n          </li>\n        ))}\n      </ul>\n      <h4>Instructions: </h4>\n      <h2 data-testid=\"instructions\">{ foodDetails.strInstructions }</h2>\n      <Button\n        disabled={ disabled }\n        type=\"button\"\n        data-testid=\"finish-recipe-btn\"\n        className=\"finishRecipe\"\n        onClick={ finishRecipe }\n      >\n        Finalizar Receita\n      </Button>\n    </div>\n  );\n}\n\nexport default FoodInProgress;\n"]},"metadata":{},"sourceType":"module"}